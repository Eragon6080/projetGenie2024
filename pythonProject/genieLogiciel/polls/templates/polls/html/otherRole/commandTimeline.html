{% extends "course.html" %}

{% load static%}

{% block content%}

<style>
    /* ... (keep your existing styles) ... */
    .timeline-chart {
        display: flex;
        align-items: center;
        padding: 10px;
        overflow: hidden;
        position: relative;
    }
    .timeline-chart .step {
        width: 20%;
        position: relative;
        text-align: center;
    }
    .timeline-chart .step .dot {
        height: 30px;
        width: 30px;
        background-color: #bbb;
        border-radius: 50%;
        display: inline-block;
        z-index: 1;
    }
    .timeline-chart .step.active .dot {
        background-color: #4CAF50 !important;
    }
    .timeline-chart .step .line {
        height: 5px;
        background-color: #bbb;
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        z-index: 0;
    }
    .timeline-chart .step:not(:last-child) .line {
        width: 200%;
    }
</style>

<div class="container mt-3">
    <h2>Setup Timeline</h2>
    <div class="btn-group btn-group-toggle" data-toggle="buttons">
        <label class="btn btn-secondary active">
            <input type="radio" name="options" id="option1" autocomplete="off" checked> Activated
        </label>
        <label class="btn btn-secondary">
            <input type="radio" name="options" id="option2" autocomplete="off"> Deactivated
        </label>
    </div>
    <table class="table table-bordered mt-3">
        <thead>
            <tr>
                <th>Step Name</th>
                <th>Optional?</th>
                <th>Start</th>
                <th>End</th>
                <th></th> <!-- Toggle column -->
            </tr>
        </thead>
        <tbody>
            {% for etape in etapes %}
            <tr>
                <td>{{ etape.description }}</td>
                <td><input type="checkbox"></td>
                <td>{{ etape.datedebut }}</td>
                <td>{{ etape.datefin }}</td>
                <td>
                    <!-- Toggle switch -->
                    <div class="custom-control custom-switch">
                        <input type="checkbox" class="custom-control-input" id="customSwitch{{ forloop.counter }}"
                               onchange="toggleStep({{ forloop.counter }});">
                        <label class="custom-control-label" for="customSwitch{{ forloop.counter }}"></label>
                    </div>
                    
                    
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <button type="button" class="btn btn-primary">Add Step</button>
    <button type="button" class="btn btn-danger">Remove Step</button>
    <button type="button" class="btn btn-success float-right">Save Changes</button>
    <br> <br>  <br><br>  <br>
    <div class="timeline-chart" id="timelineChart">
        {% for etape in etapes %}
        <div class="step" id="chartStep{{ forloop.counter }}">
            <div class="dot"></div>
            <div class="line"></div>
            <p>{{ etape.description }}</p>
        </div>
        <script>console.log("ID de l'Ã©tape : ", "{{ forloop.counter }}");</script>
        {% endfor %}
    </div>
</div>
<!-- Include Bootstrap JS and its dependencies at the end of the body for better performance and to ensure they load first -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.0/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="{% static 'admin/js/timeline.js' %}"></script>

<script>
    // Function to update the timeline chart
function updateTimelineChart(stepId, active) {
    var step = document.getElementById('chartStep' + stepId);
    if (active) {
        step.classList.add('active');
    } else {
        step.classList.remove('active');
    }
    updateLines();
}

// Update the lines between dots based on active status
function updateLines() {
    var steps = document.querySelectorAll('.timeline-chart .step');
    steps.forEach((step, index) => {
        if (index < steps.length - 1) { // Don't do this for the last step
            var nextStep = steps[index + 1];
            if (step.classList.contains('active')) {
                nextStep.querySelector('.line').style.backgroundColor = '#4CAF50';
            } else {
                nextStep.querySelector('.line').style.backgroundColor = '#bbb';
            }
        }
    });
}

// Extend the existing toggleStep function
function toggleStep(stepId) {
    console.log('Trying to find:', 'chartStep' + stepId);
    var checkbox = document.getElementById('customSwitch' + stepId);
    var checkbox = document.getElementById('customSwitch' + stepId);
    var stepIndex = Array.from(document.querySelectorAll('.custom-control-input')).indexOf(checkbox);

    // Ensure that all previous steps are checked before allowing this one to be activated
    var allPreviousChecked = true;
    document.querySelectorAll('.custom-control-input').forEach((input, index) => {
        if (index < stepIndex && !input.checked) {
            allPreviousChecked = false;
        }
    });

    if (allPreviousChecked) {
        updateTimelineChart(stepId, checkbox.checked);
    } else {
        // Uncheck the step and alert the user
        checkbox.checked = false;
        alert('Please complete previous steps first.');
    }
}
document.addEventListener('DOMContentLoaded', function() {
    var switches = document.querySelectorAll('.custom-control-input');
    switches.forEach(function(switchElem, index) {
        switchElem.addEventListener('change', function() {
            toggleStep(index + 1);
        });
    });
});


</script>


{% endblock %}
